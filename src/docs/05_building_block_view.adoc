[[section-building-block-view]]


== Building Block View

=== Whitebox Overall System
****
image::Contexto.JPG[Arquitectura del Contexto del Sistema]

Motivación::

La arquitectura del contexto del sistema puede verse reflejada en la imagen superior. Esta figura refleja de forma general la relación entre los principales elementos de alto nivel, distinguiendo dos bloques principales de construcción: UserPOD y ViadeAPP.  Por otro lado destacar el uso de componentes react y la librería react-testing que nos permite probar la aplicación y que serán explicados en el apartado 9. 
Dada la complejidad interna de estos dos bloques del nivel 0, se procede a descomponerlos en dos cajas blancas en un primer nivel (nivel 1) para especificar mejor sus detalles. 


Bloques de construcción contenidos::
En cuanto a los bloques de construcción, podemos distinguir por un lado al *POD de un usuario*, que servirá de almacén descentralizado para almacenar los datos del usuario, sus rutas, comentarios, entre otros. Por otro lado, se encuentra el bloque de la *aplicación de VIADE*, el cual se intercomunica con los PODs a través de lo que denominamos la interfaz de SOLID. Además la aplicación también se comunica con otras APIs como la API File de HTML5 o bien la API de Google Maps. En la figura también podemos observar a los usuarios, cada uno de los cuales dispone de su POD, y que son quienes decidirán si comparten o no sus datos con otros usuarios o con la aplicación.

Interfaces importantes::

image::InterfazPrincipal.jpeg[Interfaz de visualización de ruta]

En cuanto a interfaces, podemos definir por un lado la *interfaz de SOLID*, la cual podemos ver en la imagen, y que proporciona operaciones sobre los PODs de los usuarios, concretamente en este caso nos permite visualizar una ruta, compartirla, borrarla o crear una nueva. También se encuentran las *APIs de Google y File*, que nos proporcionarán servicios para representar las rutas sobre los mapas y la carga de ficheros respectivamente.
****
=== Nivel 1
****
Descripción de las cajas negras de el nivel 1.

[cols="1,2" options="header"]
|===
| **Nombre** | **Responsabilidad**
| User POD | Almacenar los datos del usuario y sus rutas, así como permitir la comunicación con la aplicación desacoplando los datos de la aplicación.
| Viade App | Representa la aplicación en su totalidad, que se encarga tanto del procesamiento de los datos de entrada del usuario como de los datos almacenados en los PODs.
|===
****


==== User POD

****
En esta primera caja negra, se engloba todo lo relacionado con los PODs de los usuarios, en donde se almacenan los datos, rutas, comentarios...de cada usuario. Es el usuario el que se encarga de permitir a la aplicación el acceso a sus datos, de tal forma que mediante la especificación de SOLID se pueda recuperar dichos datos o bien escribir datos en el POD de los usuarios.


El propósito de esta caja negra es representar a un usuario y a su POD, junto con sus datos. Para poder comunicarse con un usuario y que este pueda autenticarse, se utiliza su *WebID*. Mediante este elemento, podremos acceder a los recursos que dicho usuario tiene almacenados en su POD.

La interfaz de esta caja se resume basicamente a las operaciones de lectura y escritura en los PODs que se llevará a cabo mediante librerías que se ajustan a la especificación SOLID. Podemos distinguir las siguientes interfaces:

  * *Usuario*: representa a un usuario junto con sus propiedades básicas.
  * *Ruta*: Modela una ruta con su nombre, datos básicos como comentarios y fotos e hitos destacados con coordenadas que serviran para representar la ruta enn el mapa.
  * *Hito*: representa la entidad de un hito de una ruta concreta, almacenando su nombre, descripción,...etc pero también sus coordenadas, que serán de gran importancia.
  * *Amigo*: representa a otro usuario que se a añadido como contacto para poder compartir rutas con él, almacenando su nombre y su webID. 

A continuación, se muestra una figura de la *caja blanca* del User POD con sus elementos:

image::UserPODV2.JPG[Caja blanca para el POD del usuario]

****
==== Viade App
****
En cuanto a la segunda caja negra, esta es de vital importancia ya que representa a la aplicación en su totalidad, y es la que lleva a cabo toda la lógica de negocio de la aplicación, que está desacoplada de los datos de los usuarios, que residen en los PODs.


La responsabilidad de esta caja negra es llevar a cabo el procesamiento de los datos de acuerdo a la lógica de negocio de la aplicación, comunicándose mediante la interfaz SOLID con los usuarios y sus PODs, así como con otras APIs como la de Google Maps o la API File. Podemos distinguir entre *Front End* y *Back End*. El primero se encarga principalmente de la lógica de negocio que trata con los objetos del dominio y con los componentes de la interfaz de usuario modelados mediante Componentes JSX de *React.js*. Este módulo utilizará los *servicios de la capa de Back-End* para obtener datos y escribirlos en los PODs de los usuarios, recibiendo como respuestas grafos RDF que sirven para representar a los recursos en el navegador del usuario. Por otro lado, en el Back End se utilizan librerías como  *rdflib* o *ldflex* para hacer peticiones a los PODs de los usuarios y así tener disponible una especie de 'CRUD', lo cual se consigue mediante las tripletas (*Triple*).

La principal interfaz es la de SOLID, en donde se definen una serie de operaciones que permiten acceder a los PODs de los usuarios, siempre con su consentimiento. Estas operaciones se asemejarían a un CRUD, y están representadas en el diagrama adjunto como *Data API* Luego podemos distinguir varias interfaces tales como Ruta, Usario, y otros elementos que modelan el dominio. También podemos distinguir una *capa intermedia* entre el Front-End y el Back-End que sirve de controlador entre ambos módulos, permitiendo su comunicación. Desde el punto de vista de la persistencia, tendremos interfaces que nos proporcionen acceso CRUD a los datos de los usuarios almacenados en sus PODs.

A continuación, se adjuntan unas figuras que muestran un esquema de las principales funcionalidades de esta. *caja blanca de la aplicación Viade*:

*Ver rutas*

image::VerRutas.JPG[Diagrama de Ver Rutas]
En la imagen se puede observar como el usuario accede a las rutas de su POD a través de nuestra aplicación que usa el fichero "VerRutas.jsx" para mostrar una lista de las rutas del usuario. Una vez elegida la rutase visualizará en la pantalla del usuario mostrando la información de la ruta y permitiendo verla en un mapa gracias a "MapRuta.jxs".

*Añadir amigos*
image::Amigos.JPG[Diagrama de Amigos]
Una vez que tenemos las rutas creadas, nuestra aplicación permite añadirle comentarios y fotos y además compartirla con amigos. En esta imagen se puede ver un esquema del funcionamiento del módulo de amigos, en el cual, el usuario accede a la vista de amigos ("Friends.jxs") que le permitirá añadir un amigo o ver su lista de amigos con el nombre la foto y el webID de cada uno. Para añadir un amigo únicamente se necesita su webId y la propia aplicación actualiza inmediatamente la lista de amigos del usuario. Esta lista de amigos se guarda en el POD del propio usuario. 

*Compartir ruta*
image::CompartirRutas.JPG[Diagrama de Ver Rutas]
Después de poder crear rutas, verlas y añadir amigos, podemos compartir rutas con nuestros amigos. Para ello el usuario, a traves de nuestra aplicación, cuando está visualizando una ruta "RouteCard.jsx" le proporciona la opción de borrarla o compartirla con uno o varios amigos a la vez("SharePanel.jsx"). Una vez que el usuario A comparte la ruta con su amigo B, este puede visualizar la ruta, pero esta no se guarda en su POD, si no que el usuario A le está dando acceso a B para poder verla.   

image::ViadeApp.jpg[Diagrama de la caja blanca de Viade App]
****