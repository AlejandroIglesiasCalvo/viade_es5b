[[section-building-block-view]]


== Vista del bloque de contrucción

=== Sistema general de caja blanca

image::5-Overall.jpg[Arquitectura del Contexto del Sistema]

El objetivo de la caja blanca que se muestra en la imagen superior, es reflejar una visión global del sistema. El usuario interactúa con su propio POD, sobre el cual tiene control total, y también interacciona con la aplicación Viade, que es la caja negra que se describirá a continuación. 


==== Aplicación Viade
El bloque *Aplicación Viade*, se intercomunica con el bloque de caja blanca que representa al POD del usuario, con el cual intercambia datos. También interactúa con el usuario, pues representa la aplicación en su totalidad. 
Su responsabilidad es la de procesar las peticiones que realiza el usuario desde su navegador para comunicarse con su POD y devolverle unas respuestas en base a esta información. El tiempo de respuesta de la aplicación debe ser lo suficientemente corto como para satisfacer las peticiones del usuario en un tiempo razonable. Además, este bloque *no debería acceder* a los datos del POD del usuario, a menos que este de su consentimiento.

=== Nivel 1
image::5-Level1.jpg[Nivel 1]
En este primer nivel, se detallan los bloques de construcción contenidos en la caja negra descrita en la sección anterior, *Aplicación Viade*. Esta caja es de vital importancia ya que representa a la aplicación en su totalidad, y es la que lleva a cabo toda la lógica de negocio de la aplicación, que está desacoplada de los datos de los usuarios, que residen en los PODs.

La responsabilidad de esta caja es llevar a cabo el procesamiento de los datos de acuerdo a la lógica de negocio de la aplicación, comunicándose mediante la interfaz SOLID con los usuarios y sus PODs, así como con otras dependencias como React Leaflet o la API File. Podemos distinguir entre *Front End* y *Back End*. El primero se encarga principalmente de la lógica de negocio que trata con los objetos del dominio y con los componentes de la interfaz de usuario modelados mediante Componentes JSX de *React.js*. Este módulo utilizará los *servicios de la capa de Back-End* para obtener datos y escribirlos en los PODs de los usuarios, recibiendo como respuestas entidades del dominio de alto nivel. Por otro lado, en el Back End se utilizan librerías como  *tripledoc* para trabajar con los documentos del POD.

Antes de describir las cajas negras, vamos a explicar la nueva caja blanca de nombre *Sistema de autenticación*, la cual se encuentra dentro de la aplicación de Viade, y actúa como un sistema vecino de ambas cajas negras. Este sistema de autenticación interactúa con el Front End, ya que existen componentes de la interfaz de usuario que modelan el formulario de Log In, los cuales permiten escoger el *modo para iniciar sesión*, es decir, introduciendo directamente el WebID del usuario, o a través de un provedor de PODs, incluyendo nuestro propio servidor de PODs. De este modo, se redirige al usuario al formulario de Log In para recoger la información de sus credenciales y enviarlas al sistema de autenticación de SOLID.

El Back End también se relaciona con el sistema de autenticación, pues en muchos casos necesita acceder a los datos del usuario en sesión para realizar las consultas sobre los datos de su POD, teniendo en cuenta los permisos proporcionados por su dueño.

==== Descripción de las cajas negras de el nivel 1.
A continuación, se muestra en formato de tabla, las dos cajas negras que residen en este primer nivel, junto con una breve descripción de sus responsabilidades.
[cols="1,2" options="header"]
|===
| **Nombre** | **Responsabilidad**
| Front End | Interactuar con el usuario final, recogiendo los datos de entrada proporcionados por el mismo en las distintas operaciones disponibles a través de la interfaz. Se comunica con el backend para enviarle los datos y también para recibir los resultados de las operaciones y mostrarselas al usuario.
| BackEnd | Recibe los datos del FrontEnd y los procesa de distinta forma para obtener resultados que mostrar al usuario. Tiene la responsabilidad de acceder al POD del usuario para consultar sus datos, escribirlos o compartir información entre diversos PODs que no tienen porqué ser del usuario que está en sesión. 
|===




==== Interfaces importantes
En este primer nivel, podemos distinguir dos interfaces importantes. La primera es la *interfaz entre FrontEnd y BackEnd*, la cual está definida por una capa de servicios que actúa de fachada entre ambas capas. De este modo, el front end solo conoce los servicios que necesita y se despreocupa de cómo se lleven a cabo esos servicios en el back end.

Por otro lado, se encuentra una segunda *interfaz entre el back end y el Solid POD*, es decir, el backend no trabaja directamente sobre el POD, si no que se usan interfaces y librerías como tripledoc para manejar los documentos y los denominados *triples* despreocupándonos de lidiar con el lenguaje RDF, y así poder llevar a cabo la consulta de datos y su modificación de manera flexible.



A continuación, se adjuntan unas figuras que muestran un esquema de las principales funcionalidades de esta. *caja blanca de la aplicación Viade*:

*Ver rutas*

image::VerRutas.JPG[Diagrama de Ver Rutas]
En la imagen se puede observar como el usuario accede a las rutas de su POD a través de nuestra aplicación que usa el fichero "VerRutas.jsx" para mostrar una lista de las rutas del usuario. Una vez elegida la ruta se visualizará en la pantalla del usuario mostrando la información de la ruta y permitiendo verla en un mapa gracias a "MapRuta.jsx".

*Añadir amigos*

image::Amigos.JPG[Diagrama de Amigos]
Una vez que tenemos las rutas creadas, nuestra aplicación permite añadirle comentarios y fotos y además compartirla con amigos. En esta imagen se puede ver un esquema del funcionamiento del módulo de amigos, en el cual, el usuario accede a la vista de amigos ("Friends.jxs") que le permitirá añadir un amigo o ver su lista de amigos con el nombre la foto y el webID de cada uno. Para añadir un amigo únicamente se necesita su webId y la propia aplicación actualiza inmediatamente la lista de amigos del usuario. Esta lista de amigos se guarda en el POD del propio usuario. 

*Compartir ruta*

image::CompartirRutas.JPG[Diagrama de Ver Rutas]
Después de poder crear rutas, verlas y añadir amigos, podemos compartir rutas con nuestros amigos. Para ello el usuario, a traves de nuestra aplicación, cuando está visualizando una ruta "RouteCard.jsx" le proporciona la opción de borrarla o compartirla con uno o varios amigos a la vez("SharePanel.jsx"). Una vez que el usuario A comparte la ruta con su amigo B, este puede visualizar la ruta, pero esta no se guarda en su POD, si no que el usuario A le está dando acceso a B para poder verla.   

image::ViadeApp.jpg[Diagrama de la caja blanca de Viade App]
